<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Politie Academie - PV Training OVT</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --polblauw: #1d4e89; --goud: #f9d423; --bg: #f4f7f9; --fout: #e53e3e; --goed: #28a745; --tekst: #2d3748; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; color: var(--tekst); line-height: 1.6; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1, h2 { color: var(--polblauw); text-align: center; border-bottom: 3px solid var(--goud); padding-bottom: 10px; }
        .screen { display: none; }
        .active { display: block; }
        .zin-container { margin-bottom: 20px; padding: 15px; border-left: 5px solid var(--polblauw); background: #f8fafc; border-radius: 0 4px 4px 0; }
        .is-goed { border-left-color: var(--goed) !important; background: #f0fff4; }
        .is-fout { border-left-color: var(--fout) !important; background: #fff5f5; }
        .opdracht-label { color: var(--fout); font-weight: bold; font-size: 0.9em; display: block; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #cbd5e0; border-radius: 4px; box-sizing: border-box; font-size: 1em; }
        .btn-group { display: flex; gap: 10px; margin-top: 12px; }
        .btn-check { padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; flex: 1; transition: 0.2s; }
        .btn-check:hover { opacity: 0.8; }
        .sleutel-box { margin-top: 10px; padding: 10px; background: #e2e8f0; border-radius: 4px; display: none; border: 1px solid #cbd5e0; font-weight: 500; }
        .admin-zone { margin-top: 50px; padding: 20px; border: 2px dashed var(--polblauw); background: #f0f7ff; border-radius: 8px; }
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        .admin-table th, .admin-table td { border: 1px solid #cbd5e0; padding: 10px; text-align: left; }
        .admin-table th { background: var(--polblauw); color: white; }
        .btn-main { background: var(--polblauw); color: white; width: 100%; padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 1.1em; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen" class="screen active">
        <h1>PV-Training: Actief Schrijven</h1>
        <p style="text-align:center;">Zet de zinnen om naar de actieve verleden tijd (OVT).<br>Let op: stam+de, stam+te of klankverandering.</p>
        <input type="text" id="student-naam" placeholder="Naam Verbalisant">
        <button onclick="login()" class="btn-main" style="margin-top:20px;">START TRAINING</button>
    </div>

    <div id="input-screen" class="screen">
        <h2>Dossier Verwerking</h2>
        <div id="vragen-lijst"></div>
        <button onclick="verstuurZinnen()" class="btn-main">DOSSIER INLEVEREN</button>
    </div>

    <div id="wait-screen" class="screen">
        <h2 style="text-align:center;">Dossier Verstuurd</h2>
        <p style="text-align:center;">Wacht op de docent voor de controle-fase.</p>
    </div>

    <div id="peer-screen" class="screen">
        <h2>Controle: Dossier van <span id="review-naam" style="color:var(--polblauw)"></span></h2>
        <p>Beoordeel of de collega de zin correct heeft omgezet naar de actieve verleden tijd.</p>
        <div id="peer-lijst"></div>
    </div>

    <div class="admin-zone">
        <h4 style="margin:0 0 10px 0;">Docenten Dashboard (Projectie)</h4>
        <div style="display:flex; gap:10px;">
            <button onclick="startNakijken()" style="background:var(--goed); color:white; flex:1; padding:12px; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">START NAKIJKEN</button>
            <button onclick="wisAlles()" style="background:var(--fout); color:white; flex:1; padding:12px; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">RESET SESSIE</button>
        </div>
        <table class="admin-table">
            <thead><tr><th>Verbalisant</th><th>Voortgang / Score</th></tr></thead>
            <tbody id="score-body"></tbody>
        </table>
    </div>
</div>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyBj8dXkl1rEfyx54_MDy_tYd2P7kAeU8VQ",
        authDomain: "q2les3samirgem.firebaseapp.com",
        databaseURL: "https://q2les3samirgem-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "q2les3samirgem",
        storageBucket: "q2les3samirgem.firebasestorage.app",
        messagingSenderId: "8681998187",
        appId: "1:8681998187:web:fd08067494a010dc572e2e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // De zinnenpool: Van passief/fout naar actieve OVT
    const zinnenPool = [const zinnenPool = [
    // --- CATEGORIE 1: JURIDISCH & WEGNEMEN (Sterk/Scheidbaar) ---
    {fout: "De dader heeft de tas weggenome", goed: "De dader nam de tas weg."},
    {fout: "De verdachte heeft de sieraden weggenome", goed: "De verdachte nam de sieraden weg."},
    {fout: "De dief heeft de portemonnee weggenome", goed: "De dief nam de portemonnee weg."},
    {fout: "De verdachte heeft de auto weggenome", goed: "De verdachte nam de auto weg."},
    {fout: "De insluiper heeft de laptop weggenome", goed: "De insluiper nam de laptop weg."},
    {fout: "De overvaller heeft het geld weggenome", goed: "De overvaller nam het geld weg."},
    {fout: "De verdachte heeft de fiets weggenome", goed: "De verdachte nam de fiets weg."},

    // --- CATEGORIE 2: ZWAKKE WERKWOORDEN - STAM + DE (Zonder 't kofschip) ---
    {fout: "De agent heeft de verdachte fouilleerd", goed: "De agent fouilleerde de verdachte."},
    {fout: "De recherche heeft de beelden geanalyseert", goed: "De recherche analyseerde de beelden."},
    {fout: "De verdachte heeft de moord ontkent", goed: "De verdachte ontkende de moord."},
    {fout: "De centralist heeft de eenheid gestuurt", goed: "De centralist stuurde de eenheid."},
    {fout: "De agent heeft de man kalmeert", goed: "De agent kalmeerde de man."},
    {fout: "De rechercheur heeft de getuige hoort", goed: "De rechercheur hoorde de getuige."},
    {fout: "De verdachte heeft de agent beledigt", goed: "De verdachte beledigde de agent."},
    {fout: "De politie heeft de weg blokkeert", goed: "De politie blokkeerde de weg."},
    {fout: "De agent heeft de boete incasseert", goed: "De agent incasseerde de boete."},
    {fout: "De verdachte heeft de camerabeelden negeert", goed: "De verdachte negeerde de camerabeelden."},
    {fout: "De verbalisant heeft de situatie registreert", goed: "De verbalisant registreerde de situatie."},
    {fout: "De rechercheur heeft de verdachte schaduwt", goed: "De rechercheur schaduwde de verdachte."},
    {fout: "De agent heeft de verklaring verifieert", goed: "De agent verifieerde de verklaring."},
    {fout: "De hondengeleider heeft de hond traint", goed: "De hondengeleider trainde de hond."},
    {fout: "De verdachte heeft de ruit forceert", goed: "De verdachte forceerde de ruit."},
    {fout: "De agent heeft de omgeving verkent", goed: "De agent verkende de omgeving."},
    {fout: "De recherche heeft de telefoon tapt", goed: "De recherche tapte de telefoon."},
    {fout: "De verdachte heeft de getuige terroriseert", goed: "De verdachte terroriseerde de getuige."},

    // --- CATEGORIE 3: ZWAKKE WERKWOORDEN - STAM + TE (Met 't kofschip-x) ---
    {fout: "De verbalisant heeft de aangifte typt", goed: "De verbalisant typte de aangifte."},
    {fout: "De inbreker heeft de kluis kraakt", goed: "De inbreker kraakte de kluis."},
    {fout: "De agent heeft de ruzie sust", goed: "De agent suste de ruzie."},
    {fout: "De officier heeft het rapport getekent", goed: "De officier tekende het rapport."},
    {fout: "De dader heeft de tas rooft", goed: "De dader roofde de tas."},
    {fout: "De agent heeft de achtervolging staakt", goed: "De agent staakte de achtervolging."},
    {fout: "De recherche heeft de zaak onderzocht", goed: "De recherche onderzocht de zaak."},
    {fout: "De verdachte heeft de ruit ingegooid", goed: "De verdachte gooide de ruit in."},
    {fout: "De agent heeft de verdachte boeit", goed: "De agent boeide de verdachte."},
    {fout: "De verbalisant heeft de rechten voorelezen", goed: "De verbalisant las de rechten voor."},
    {fout: "De inbreker heeft de deur forceert", goed: "De inbreker forceerde de deur."},
    {fout: "De agent heeft de verdachte arresteert", goed: "De agent arresteerde de verdachte."},
    {fout: "De agent heeft de man fouilleert", goed: "De agent fouilleerde de man."},
    {fout: "De verdachte heeft de bevelen negeert", goed: "De verdachte negeerde de bevelen."},
    {fout: "De officier heeft het proces verbaalt", goed: "De officier verbaliseerde de zaak."},

    // --- CATEGORIE 4: STERKE WERKWOORDEN (Klankverandering) ---
    {fout: "De inbreker is door het dak klomme", goed: "De inbreker klom door het dak."},
    {fout: "De agent heeft de dader vange", goed: "De agent ving de dader."},
    {fout: "De rechercheur heeft het dossier schreve", goed: "De rechercheur schreef het dossier."},
    {fout: "De agent heeft de man houde", goed: "De agent hield de man aan."},
    {fout: "De getuige heeft de dader aanweze", goed: "De getuige wees de dader aan."},
    {fout: "De agent heeft zijn wapen trokke", goed: "De agent trok zijn wapen."},
    {fout: "De verdachte heeft de ruit smete", goed: "De verdachte smeet de ruit in."},
    {fout: "De dader is uit het zicht ronne", goed: "De dader rende uit het zicht."},
    {fout: "De recherche heeft de sporen zocht", goed: "De recherche zocht de sporen."},
    {fout: "De agent heeft de verdachte sproke", goed: "De agent sprak de verdachte."},
    {fout: "De verdachte heeft de wet treden", goed: "De verdachte overtrad de wet."},
    {fout: "De politie heeft de drugs vonde", goed: "De politie vond de drugs."},
    {fout: "De verdachte heeft de waarheid liege", goed: "De verdachte loog de waarheid."},
    {fout: "De dader is over het hek spronge", goed: "De dader sprong over het hek."},
    {fout: "De agent heeft de dief pakt", goed: "De agent pakte de dief."},
    {fout: "De officier heeft de zaak zie", goed: "De officier zag de zaak in."},
    {fout: "De verdachte heeft de ruit broke", goed: "De verdachte brak de ruit."},
    {fout: "De agent heeft de dief achtervolge", goed: "De agent achtervolgde de dief."},
    {fout: "De verdachte is op de vlucht slage", goed: "De verdachte sloeg op de vlucht."},
    {fout: "De recherche heeft de dader volge", goed: "De recherche volgde de dader."},
    {fout: "De agent heeft de hond roepe", goed: "De agent riep de hond."},
    {fout: "De dader heeft het geld stole", goed: "De dader stal het geld."},
    {fout: "De verdachte heeft een verklaring lege", goed: "De verdachte legde een verklaring af."},
    {fout: "De dief is door de mand valle", goed: "De dief viel door de mand."},
    {fout: "De agent heeft de situatie bekeke", goed: "De agent bekeek de situatie."},
    {fout: "De verbalisant heeft de zaak slote", goed: "De verbalisant sloot de zaak."},
    {fout: "De agent heeft de weg afzet", goed: "De agent zette de weg af."},
    {fout: "De recherche heeft het bewijs vonde", goed: "De recherche vond het bewijs."},
    {fout: "De verdachte heeft de ruit ingeslage", goed: "De verdachte sloeg de ruit in."},
    {fout: "De dader heeft de agent geslage", goed: "De dader sloeg de agent."},
    {fout: "De recherche heeft de sporen zocht", goed: "De recherche zocht de sporen."},
    {fout: "De agent heeft de man roepe", goed: "De agent riep de man."},
    {fout: "De verbalisant heeft de rechten vertelt", goed: "De verbalisant vertelde de rechten."},
    {fout: "De agent heeft de dader grepe", goed: "De agent greep de dader."},
    {fout: "De rechercheur heeft de beelden zie", goed: "De rechercheur zag de beelden."},
    {fout: "De agent heeft de verdachte klem zet", goed: "De agent zette de verdachte klem."},
    {fout: "De dader heeft de tas rooft", goed: "De dader roofde de tas."},
    {fout: "De agent heeft de getuige hoort", goed: "De agent hoorde de getuige."},
    {fout: "De officier heeft de zaak onderzoek", goed: "De officier onderzocht de zaak."},
    {fout: "De verdachte heeft de agent bedreigt", goed: "De verdachte bedreigde de agent."},
    {fout: "De agent heeft de verdachte fouilleert", goed: "De agent fouilleerde de verdachte."},
    {fout: "De recherche heeft de zaak slote", goed: "De recherche sloot de zaak."},
    {fout: "De verdachte heeft de diefstal bekent", goed: "De verdachte bekende de diefstal."},
    {fout: "De agent heeft de ruzie sust", goed: "De agent suste de ruzie."},
    {fout: "De dader heeft de tas weggenome", goed: "De dader nam de tas weg."},
    {fout: "De agent heeft de situatie inschat", goed: "De agent schatte de situatie in."},
    {fout: "De verdachte heeft de ruit ingegooid", goed: "De verdachte gooide de ruit in."},
    {fout: "De agent heeft de eenheid gestuurt", goed: "De agent stuurde de eenheid."},
    {fout: "De dader is via het raam vlucht", goed: "De dader vluchtte via het raam."},
    {fout: "De agent heeft de achtervolging staakt", goed: "De agent staakte de achtervolging."},
    {fout: "De verdachte heeft de agent geduwt", goed: "De verdachte duwde de agent."},
    {fout: "De dader heeft de sieraden stole", goed: "De dader stal de sieraden."},
    {fout: "De agent heeft de rust herstelt", goed: "De agent herstelde de rust."},
    {fout: "De recherche heeft de sporen vonde", goed: "De recherche vond de sporen."},
    {fout: "De dader is over de schutting klomme", goed: "De dader klom over de schutting."},
    {fout: "De agent heeft de man kalmeert", goed: "De agent kalmeerde de man."},
    {fout: "De dader heeft de auto stole", goed: "De dader stal de auto."},
    {fout: "De agent heeft de ruit broke", goed: "De agent brak de ruit."},
    {fout: "De verdachte heeft de waarheid sproke", goed: "De verdachte sprak de waarheid."},
    {fout: "De agent heeft de dader pakt", goed: "De agent pakte de dader."},
    {fout: "De recherche heeft de beelden bekeke", goed: "De recherche bekeek de beelden."}
];
        {fout: "De dader heeft de tas weggenome", goed: "De dader nam de tas weg."},
        {fout: "De agent heeft de verdachte fouilleerd", goed: "De agent fouilleerde de verdachte."},
        {fout: "De recherche heeft de beelden geanalyseert", goed: "De recherche analyseerde de beelden."},
        {fout: "De getuige heeft de dader herkent", goed: "De getuige herkende de dader."},
        {fout: "De verdachte heeft de diefstal ontkent", goed: "De verdachte ontkende de diefstal."},
        {fout: "De verbalisant heeft de rechten voorelezen", goed: "De verbalisant las de rechten voor."},
        {fout: "De inbreker is via het dak klomme", goed: "De inbreker klom via het dak."},
        {fout: "De agent heeft de weg afzet", goed: "De agent zette de weg af."},
        {fout: "De centralist heeft de eenheid gestuurt", goed: "De centralist stuurde de eenheid."},
        {fout: "De politie heeft het bewijs veilig stelt", goed: "De politie stelde het bewijs veilig."},
        {fout: "De dader is via de achterdeur vlucht", goed: "De dader vluchtte via de achterdeur."},
        {fout: "De agent heeft de ruzie sust", goed: "De agent suste de ruzie."},
        {fout: "De verdachte heeft de sieraden weggenome", goed: "De verdachte nam de sieraden weg."},
        {fout: "De officier heeft het rapport getekent", goed: "De officier tekende het rapport."},
        {fout: "De agent heeft de man kalmeert", goed: "De agent kalmeerde de man."},
        {fout: "De eenheid heeft de dader achtervolgt", goed: "De eenheid achtervolgde de dader."},
        {fout: "De verbalisant heeft de getuige hoort", goed: "De verbalisant hoorde de getuige."},
        {fout: "De verdachte heeft de agent beledigt", goed: "De verdachte beledigde de agent."},
        {fout: "De inbreker heeft de kluis kraakt", goed: "De inbreker kraakte de kluis."},
        {fout: "De verbalisant heeft de aangifte typt", goed: "De verbalisant typte de aangifte."},
        {fout: "De agent heeft de hond roepen", goed: "De agent riep de hond."},
        {fout: "De dief heeft de portemonnee weggenome", goed: "De dief nam de portemonnee weg."},
        {fout: "De verdachte heeft de regels negeert", goed: "De verdachte negeerde de regels."},
        {fout: "De agent heeft de situatie inschat", goed: "De agent schatte de situatie in."},
        {fout: "De dief heeft de sieraden stelen", goed: "De dief stal de sieraden."},
        {fout: "De dader is in de val lokt", goed: "De dader lokte in de val."},
        {fout: "De agent heeft zijn wapen trokke", goed: "De agent trok zijn wapen."},
        {fout: "De verdachte heeft de ruit smete", goed: "De verdachte smeet de ruit in."},
        {fout: "De recherche heeft de sporen zocht", goed: "De recherche zocht de sporen."}
        // Uit te breiden naar 100 zinnen volgens dit patroon
    ];

    let mijnSelectie = [];
    let mijnId = "";
    let peerIdScore = "";
    let lokaleScore = 0;
    let beantwoord = 0;

    function login() {
        const naam = document.getElementById('student-naam').value;
        if(!naam) return alert("Naam verplicht.");
        let idx = Array.from(Array(zinnenPool.length).keys()).sort(() => Math.random() - 0.5);
        mijnSelectie = idx.slice(0, 25);
        showScreen('input-screen');
        renderVragen();
    }

    function renderVragen() {
        const div = document.getElementById('vragen-lijst');
        div.innerHTML = mijnSelectie.map(i => `
            <div class="zin-container">
                <span class="opdracht-label">Zet om naar actieve OVT:</span>
                <span style="display:block; margin-bottom:10px;">${zinnenPool[i].fout}</span>
                <input type="text" id="zin-${i}" autocomplete="off" placeholder="Typ de actieve zin...">
            </div>
        `).join('');
    }

    function verstuurZinnen() {
        const antwoorden = {};
        mijnSelectie.forEach(idx => { antwoorden[idx] = document.getElementById(`zin-${idx}`).value; });
        db.ref('taaltraining/studenten').push({
            naam: document.getElementById('student-naam').value,
            antwoorden: antwoorden,
            mijnSelectie: mijnSelectie,
            score: 0,
            status: "Ingeleverd"
        }).then(ref => { mijnId = ref.key; showScreen('wait-screen'); });
    }

    function beoordeel(btn, type) {
        const container = btn.closest('.zin-container');
        if(container.dataset.beoordeeld) return;
        container.dataset.beoordeeld = "true";
        beantwoord++;
        if(type === 'goed') { lokaleScore++; container.classList.add('is-goed'); } 
        else { container.classList.add('is-fout'); }
        container.querySelector('.sleutel-box').style.display = 'block';
        db.ref('taaltraining/studenten/' + peerIdScore).update({ 
            score: lokaleScore,
            status: "Beoordeeld (" + beantwoord + "/25)"
        });
    }

    function renderPeerReview(pData, pKey) {
        peerIdScore = pKey;
        showScreen('peer-screen');
        document.getElementById('review-naam').innerText = pData.naam;
        const div = document.getElementById('peer-lijst');
        div.innerHTML = pData.mijnSelectie.map(idx => `
            <div class="zin-container">
                <span style="font-size:0.8em; color:gray;">OPDRACHT: ${zinnenPool[idx].fout}</span>
                <span style="display:block; margin:10px 0; font-weight:bold;">INVOER: ${pData.antwoorden[idx] || '[Geen invoer]'}</span>
                <div class="btn-group">
                    <button class="btn-check" style="background:var(--goed);" onclick="beoordeel(this, 'goed')">CORRECT</button>
                    <button class="btn-check" style="background:var(--fout);" onclick="beoordeel(this, 'fout')">ONJUIST</button>
                </div>
                <div class="sleutel-box">Sleutel: ${zinnenPool[idx].goed}</div>
            </div>
        `).join('');
    }

    db.ref('taaltraining/studenten').on('value', snap => {
        const body = document.getElementById('score-body');
        body.innerHTML = "";
        snap.forEach(child => {
            const s = child.val();
            body.innerHTML += `<tr><td>${s.naam}</td><td><strong>${s.score} / 25</strong> (${s.status || 'Bezig'})</td></tr>`;
        });
    });

    db.ref('taaltraining/status').on('value', snap => {
        if(snap.val() === 'review' && mijnId) {
            db.ref('taaltraining/studenten/' + mijnId).once('value', sSnap => {
                const targetId = sSnap.val().toegewezenAan;
                db.ref('taaltraining/studenten/' + targetId).once('value', pSnap => renderPeerReview(pSnap.val(), pSnap.key));
            });
        }
    });

    function startNakijken() {
        db.ref('taaltraining/studenten').once('value', snap => {
            let ids = []; snap.forEach(c => ids.push(c.key));
            if(ids.length < 2) return alert("Niet genoeg deelnemers.");
            let shuf = ids.sort(() => Math.random() - 0.5);
            shuf.forEach((id, i) => db.ref('taaltraining/studenten/' + id).update({ toegewezenAan: shuf[(i+1)%shuf.length], status: "Wordt nagekeken" }));
            db.ref('taaltraining/status').set('review');
        });
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function wisAlles() { if(confirm("Reset alle data?")) db.ref('taaltraining').set(null).then(() => location.reload()); }
</script>
</body>
</html>
