<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Politie Academie - Master Controle Paneel</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --polblauw: #1d4e89; --goud: #f9d423; --bg: #f4f7f9; --fout: #e53e3e; --goed: #28a745; --tekst: #2d3748; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; color: var(--tekst); }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1, h2 { color: var(--polblauw); text-align: center; border-bottom: 3px solid var(--goud); padding-bottom: 10px; }
        .screen { display: none; }
        .active { display: block; }
        .zin-container { margin-bottom: 20px; padding: 15px; border-left: 5px solid var(--polblauw); background: #f8fafc; }
        .is-goed { border-left-color: var(--goed) !important; background: #f0fff4; }
        .is-fout { border-left-color: var(--fout) !important; background: #fff5f5; }
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-check { padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; flex: 1; }
        .sleutel-box { margin-top: 10px; padding: 10px; background: #e2e8f0; border-radius: 4px; display: none; font-size: 0.9em; }
        .eindrapport { background: var(--polblauw); color: white; padding: 25px; border-radius: 8px; text-align: center; margin-top: 30px; }
        
        /* Docent Tabel */
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        .admin-table th, .admin-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .admin-table th { background: var(--polblauw); color: white; }
        .admin-zone { margin-top: 60px; padding: 20px; border: 2px dashed var(--polblauw); border-radius: 8px; background: #ebf8ff; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen" class="screen active">
        <h1>Taalcheck Verbalisanten</h1>
        <input type="text" id="student-naam" style="width:100%; padding:12px;" placeholder="Naam verbalisant">
        <button onclick="login()" style="background:var(--polblauw); color:white; width:100%; padding:15px; border:none; border-radius:4px; cursor:pointer; margin-top:10px; font-weight:bold;">START DOSSIER</button>
    </div>

    <div id="input-screen" class="screen">
        <h2>Dossier Invoeren</h2>
        <div id="vragen-lijst"></div>
        <button onclick="verstuurZinnen()" style="background:var(--polblauw); color:white; width:100%; padding:15px; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">INLEVEREN</button>
    </div>

    <div id="wait-screen" class="screen">
        <h2 style="text-align:center;">Dossier verzonden</h2>
        <p style="text-align:center;">Wacht op de herverdeling door de docent.</p>
    </div>

    <div id="peer-screen" class="screen">
        <h2>Controle: Dossier van <span id="review-naam"></span></h2>
        <div id="peer-lijst"></div>
        <div id="eindrapport" class="eindrapport" style="display:none;">
            <h3>Resultaat verwerkt</h3>
            <p>Je hebt de score van je collega doorgegeven aan het systeem.</p>
        </div>
    </div>

    <div class="admin-zone">
        <h3>Docenten Paneel (Projecteer dit scherm)</h3>
        <button onclick="startNakijken()" style="background:var(--goed); color:white; padding:10px; border:none; cursor:pointer; width:48%;">VERDEEL DOSSIERS</button>
        <button onclick="wisAlles()" style="background:var(--fout); color:white; padding:10px; border:none; cursor:pointer; width:48%;">SESSERESET</button>
        
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Verbalisant</th>
                    <th>Status</th>
                    <th>Score (Correct/25)</th>
                </tr>
            </thead>
            <tbody id="score-body">
                </tbody>
        </table>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBj8dXkl1rEfyx54_MDy_tYd2P7kAeU8VQ",
        authDomain: "q2les3samirgem.firebaseapp.com",
        databaseURL: "https://q2les3samirgem-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "q2les3samirgem",
        storageBucket: "q2les3samirgem.firebasestorage.app",
        messagingSenderId: "8681998187",
        appId: "1:8681998187:web:fd08067494a010dc572e2e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Voeg hier je 100 zinnen toe zoals in de vorige stap
    const zinnenPool = [
        {fout: "De verdachte is direct aangehoude.", goed: "De verdachte is direct na de melding aangehouden."},
        // ... (etc)
    ];

    let mijnSelectie = [];
    let mijnId = "";
    let peerIdVoorScore = "";
    let lokaleScore = 0;
    let beoordeeldAantal = 0;

    function login() {
        const naam = document.getElementById('student-naam').value;
        if(!naam) return alert("Naam?");
        let idx = Array.from(Array(100).keys()).sort(() => Math.random() - 0.5);
        mijnSelectie = idx.slice(0, 25);
        showScreen('input-screen');
        renderVragen();
    }

    function renderVragen() {
        const div = document.getElementById('vragen-lijst');
        div.innerHTML = mijnSelectie.map(i => `<div class="zin-container"><span class="foute-zin">${zinnenPool[i]?.fout || 'Foutieve zin'}</span><input type="text" id="zin-${i}"></div>`).join('');
    }

    function verstuurZinnen() {
        const antwoorden = {};
        mijnSelectie.forEach(idx => { antwoorden[idx] = document.getElementById(`zin-${idx}`).value; });
        db.ref('taaltraining/studenten').push({
            naam: document.getElementById('student-naam').value,
            antwoorden: antwoorden,
            mijnSelectie: mijnSelectie,
            score: 0,
            status: "Ingeleverd"
        }).then(ref => { mijnId = ref.key; showScreen('wait-screen'); });
    }

    function beoordeel(element, status) {
        const container = element.closest('.zin-container');
        if(container.dataset.klaar) return;
        container.dataset.klaar = "true";
        beoordeeldAantal++;
        
        if(status === 'goed') {
            container.classList.add('is-goed');
            lokaleScore++;
        } else {
            container.classList.add('is-fout');
        }
        container.querySelector('.sleutel-box').style.display = 'block';

        // Update score van de MAKER in Firebase
        db.ref('taaltraining/studenten/' + peerIdVoorScore).update({
            score: lokaleScore,
            status: "Beoordeeld (" + beoordeeldAantal + "/25)"
        });

        if(beoordeeldAantal === 25) document.getElementById('eindrapport').style.display = 'block';
    }

    function renderPeerReview(pData, pKey) {
        peerIdVoorScore = pKey;
        showScreen('peer-screen');
        document.getElementById('review-naam').innerText = pData.naam;
        const div = document.getElementById('peer-lijst');
        div.innerHTML = pData.mijnSelectie.map(idx => `
            <div class="zin-container">
                <span class="foute-zin">Origineel: ${zinnenPool[idx]?.fout}</span>
                <span style="display:block; margin:5px 0;"><strong>Invoer:</strong> ${pData.antwoorden[idx]}</span>
                <div class="btn-group">
                    <button class="btn-check" style="background:var(--goed)" onclick="beoordeel(this, 'goed')">CORRECT</button>
                    <button class="btn-check" style="background:var(--fout)" onclick="beoordeel(this, 'fout')">ONJUIST</button>
                </div>
                <div class="sleutel-box">Sleutel: ${zinnenPool[idx]?.goed}</div>
            </div>
        `).join('');
    }

    // LIVE MONITOR VOOR DOCENT
    db.ref('taaltraining/studenten').on('value', snap => {
        const tbody = document.getElementById('score-body');
        tbody.innerHTML = "";
        snap.forEach(child => {
            const s = child.val();
            tbody.innerHTML += `<tr><td>${s.naam}</td><td>${s.status}</td><td><strong>${s.score}</strong></td></tr>`;
        });
    });

    db.ref('taaltraining/status').on('value', snap => {
        if(snap.val() === 'review' && mijnId) {
            db.ref('taaltraining/studenten/' + mijnId).once('value', sSnap => {
                const targetId = sSnap.val().toegewezenAan;
                db.ref('taaltraining/studenten/' + targetId).once('value', pSnap => renderPeerReview(pSnap.val(), pSnap.key));
            });
        }
    });

    function startNakijken() {
        db.ref('taaltraining/studenten').once('value', snap => {
            let ids = []; snap.forEach(c => ids.push(c.key));
            let shuf = ids.sort(() => Math.random() - 0.5);
            shuf.forEach((id, i) => db.ref('taaltraining/studenten/' + id).update({ toegewezenAan: shuf[(i+1)%shuf.length], status: "Wordt nagekeken" }));
            db.ref('taaltraining/status').set('review');
        });
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function wisAlles() { if(confirm("Reset?")) db.ref('taaltraining').set(null).then(() => location.reload()); }
</script>
</body>
</html>
