<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Politie Academie - PV Training Live Digibord</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --polblauw: #1d4e89; --goud: #f9d423; --bg: #f4f7f9; --fout: #e53e3e; --goed: #28a745; --tekst: #2d3748; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; color: var(--tekst); margin: 0; }
        .container { max-width: 950px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; }
        .screen { display: none; }
        .active { display: block; }
        .btn-main { background: var(--polblauw); color: white; width: 100%; padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }

        /* WHITEBOARD STYLES */
        #whiteboard-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; flex-direction: column; }
        .wb-toolbar { background: var(--polblauw); padding: 10px; display: flex; gap: 10px; align-items: center; color: white; }
        #wb-canvas { flex-grow: 1; cursor: crosshair; touch-action: none; background: #fff; }
        .wb-btn { padding: 5px 12px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; }
        .color-dot { width: 25px; height: 25px; border-radius: 50%; border: 2px solid white; cursor: pointer; }
        .text-input { position: absolute; background: transparent; border: 1px dashed #ccc; outline: none; font-size: 20px; padding: 5px; min-width: 50px; }
    </style>
</head>
<body>

<div id="whiteboard-overlay">
    <div class="wb-toolbar">
        <span style="font-weight:bold; margin-right:10px;">LIVE BORD</span>
        <button class="wb-btn" onclick="setWbMode('draw')">‚úèÔ∏è Stift</button>
        <button class="wb-btn" onclick="setWbMode('text')">‚å®Ô∏è Tekst</button>
        <div class="color-dot" onclick="setWbColor('#1d4e89')" style="background: #1d4e89;"></div>
        <div class="color-dot" onclick="setWbColor('#e53e3e')" style="background: #e53e3e;"></div>
        <div class="color-dot" onclick="setWbColor('#28a745')" style="background: #28a745;"></div>
        <button class="wb-btn" onclick="clearWbServer()" style="background:#ddd; color: #333; margin-left: auto;">üóëÔ∏è Wis Alles</button>
        <button class="wb-btn" onclick="closeWb()" style="background:var(--fout); color: white;">‚ùå Sluit</button>
    </div>
    <div style="position: relative; flex-grow: 1;" id="wb-container">
        <canvas id="wb-canvas"></canvas>
    </div>
</div>

<div class="container">
    <div id="login-screen" class="screen active">
        <button onclick="openWb()" style="position: absolute; right: 10px; top: 10px; padding: 10px; background: var(--goud); border: none; border-radius: 4px; font-weight: bold; cursor: pointer;">üñ•Ô∏è OPEN LIVE DIGIBORD</button>
        <h1 style="color:var(--polblauw); text-align:center;">PV-Training 100</h1>
        <p style="text-align:center;">Klik op de gouden knop om het gezamenlijke bord te openen.</p>
    </div>
</div>

<script>
    // FIREBASE INITIALISATIE
    const firebaseConfig = {
        apiKey: "AIzaSyBj8dXkl1rEfyx54_MDy_tYd2P7kAeU8VQ",
        authDomain: "q2les3samirgem.firebaseapp.com",
        databaseURL: "https://q2les3samirgem-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "q2les3samirgem",
        storageBucket: "q2les3samirgem.firebasestorage.app",
        messagingSenderId: "8681998187",
        appId: "1:8681998187:web:fd08067494a010dc572e2e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // WHITEBOARD VARIABELEN
    const wbCanvas = document.getElementById('wb-canvas');
    const wbCtx = wbCanvas.getContext('2d');
    const wbContainer = document.getElementById('wb-container');
    let wbDrawing = false;
    let wbMode = 'draw';
    let wbColor = '#1d4e89';
    let lastX = 0;
    let lastY = 0;

    function openWb() { 
        document.getElementById('whiteboard-overlay').style.display = 'flex'; 
        wbCanvas.width = window.innerWidth;
        wbCanvas.height = window.innerHeight - 50;
        listenToWhiteboard(); // Start met luisteren naar wijzigingen van anderen
    }

    function closeWb() { document.getElementById('whiteboard-overlay').style.display = 'none'; }
    function setWbMode(m) { wbMode = m; }
    function setWbColor(c) { wbColor = c; }

    // Wis het bord voor iedereen
    function clearWbServer() {
        if(confirm("Dit wist het bord voor iedereen. Weet je het zeker?")) {
            db.ref('whiteboard').set(null);
        }
    }

    // Teken lokaal en stuur naar server
    wbCanvas.addEventListener('mousedown', (e) => {
        if(wbMode === 'draw') {
            wbDrawing = true;
            [lastX, lastY] = [e.clientX, e.clientY - 50];
        } else {
            // Tekst toevoegen en naar Firebase sturen
            const textId = Date.now();
            const textData = {
                id: textId,
                x: e.clientX,
                y: e.clientY - 50,
                text: "Typ hier...",
                color: wbColor
            };
            db.ref('whiteboard/texts/' + textId).set(textData);
        }
    });

    wbCanvas.addEventListener('mousemove', (e) => {
        if(!wbDrawing) return;
        const currentX = e.clientX;
        const currentY = e.clientY - 50;

        // Stuur lijn-co√∂rdinaten naar Firebase
        const lineRef = db.ref('whiteboard/lines').push();
        lineRef.set({
            x0: lastX, y0: lastY,
            x1: currentX, y1: currentY,
            color: wbColor
        });

        [lastX, lastY] = [currentX, currentY];
    });

    wbCanvas.addEventListener('mouseup', () => wbDrawing = false);

    // LIVE LUISTEREN NAAR DATABASE
    function listenToWhiteboard() {
        // Luister naar nieuwe lijnen
        db.ref('whiteboard/lines').on('child_added', snap => {
            const data = snap.val();
            drawRemoteLine(data.x0, data.y0, data.x1, data.y1, data.color);
        });

        // Luister naar nieuwe teksten
        db.ref('whiteboard/texts').on('child_added', snap => {
            const data = snap.val();
            createRemoteText(data);
        });

        // Luister naar 'Wis Alles'
        db.ref('whiteboard').on('value', snap => {
            if(!snap.exists()) {
                wbCtx.clearRect(0, 0, wbCanvas.width, wbCanvas.height);
                wbContainer.querySelectorAll('.text-input').forEach(el => el.remove());
            }
        });
    }

    function drawRemoteLine(x0, y0, x1, y1, color) {
        wbCtx.beginPath();
        wbCtx.moveTo(x0, y0);
        wbCtx.lineTo(x1, y1);
        wbCtx.strokeStyle = color;
        wbCtx.lineWidth = 3;
        wbCtx.lineCap = 'round';
        wbCtx.stroke();
    }

    function createRemoteText(data) {
        if(document.getElementById('txt-' + data.id)) return;
        const input = document.createElement('div');
        input.id = 'txt-' + data.id;
        input.contentEditable = true;
        input.className = 'text-input';
        input.style.left = data.x + 'px';
        input.style.top = data.y + 'px';
        input.style.color = data.color;
        input.innerText = data.text;
        
        // Update tekst live voor anderen als je stopt met typen
        input.addEventListener('blur', () => {
            db.ref('whiteboard/texts/' + data.id).update({ text: input.innerText });
        });

        wbContainer.appendChild(input);
    }
</script>
</body>
</html>
